<div class='row'>
  <div class='col-md-8 col-md-offset-2'>
    <div>
      <h3 class='<%= get_course_css_class(@course) %> underline_link'><%= link_to (@course.subject.to_s + ' ' + @course.code.to_s), course_path(@course) %></h3>
    </div>

    <% if current_user.is_taking_course?(@course) %>
      <% c = current_scenario.get_by_course(@course) %>
      <% unless c.semester.nil? or c.year.nil? %>
        <p><%= t('course.inprogress.label') %> <%= c.semester.to_s.capitalize %> <%= c.year %></p>
      <% end %>
    <% end %>

    <p><%= @course.name %></p>

    <p><%= @course.hours %> Hours, <%= @course.credit %> Credits</p>

    <p><%= @course.description %></p>

    <p>Prerequisites:
      <% if @course.prerequisite.nil? %>
        None.
      <% else %>
        <%= raw(get_expr_html(@course.prerequisite)) %>
      <% end %>
    </p>

    <p>Corequisites:
      <% if @course.corequisite.nil? %>
        None.
      <% else %>
        <%= raw(get_expr_html(@course.corequisite)) %>
      <% end %>
    </p>

    <% unless current_user.nil? %>
      <% if current_user.is_taking_course?(@course) or current_user.has_completed_course?(@course) %>
        <% coursesindb = current_scenario.taking_courses.to_a %>
        <% coursesindb.concat(current_user.completed_courses.to_a) %>
        <% variable = -1 %>
        <% coursesindb.each do |cid| %>
          <% if cid.course == @course %>
            <% variable = cid %>
          <% end %>
        <% end %>
        <% if current_user.is_taking_course?(@course) %>
          <div class='text-center'>
            <div class='btn-group'>
              <% unless current_user.reviewed_course?(@course) %>
                <a href='' class='btn btn-success' rel='tooltip' data-toggle='tooltip' title='Mark Completed'><span class='whitetext glyphicon glyphicon-ok-sign'></span></a>
              <% end %>
              <a href='' class='btn btn-danger' rel='tooltip' data-toggle='tooltip' title='Remove'><span class='whitetext glyphicon glyphicon-remove-sign'></span></a>
            </div>
          </div>
          </div>

        <% else %>
          <div class='text-center'>
            <div class='btn-group'>
              <% unless current_user.reviewed_course?(@course) %>
                <a href='<%= course_review_new_path(@course) %>' class='btn btn-success' rel='tooltip' data-toggle='tooltip' title='Review'><span class='whitetext glyphicon glyphicon-bullhorn'></span></a>
              <% end %>
              <a href='' class='btn btn-danger' rel='tooltip' data-toggle='tooltip' title='Remove'><span class='whitetext glyphicon glyphicon-remove-sign'></span></a>
            </div>
          </div>
        <% end %>
      <% else %>
        <div class='text-center'>
          <div class='btn-group'>
            <a href='<%= user_take_course_path(@course) %>' class='btn btn-warning' rel='tooltip' data-toggle='tooltip' title='Mark In-Progress'><span class='whitetext glyphicon glyphicon-plus-sign'></span></a>
            <a href='<%= user_complete_course_path(@course) %>' class='btn btn-success' rel='tooltip' data-toggle='tooltip' title='Mark Completed'><span class='whitetext glyphicon glyphicon-ok-sign'></span></a>
          </div>
        </div>
      <% end %>
    <% end %>



    <% reviews = @course.reviews %>
    <% if reviews.size > 0 %>
      <hr>
      <h2>Reviews (<%= reviews.size %>)</h2>
      <% reviews.each do |r| %>
        <div>
          <p><%= r.user.email.split('@')[0] %></p>

          <p><%= r.comment %></p>

          <div class='row'>
            <% r.ratings.each do |s| %>
              <div class='col-md-4'>
                <label><%= s.criteria.name %>: </label>
                <span class='badge'><%= s.score %></span>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    <% end %>
    </div>
</div>