<div>
  <h3 class='<%= get_course_css_class(@course) %> underline_link'><%= link_to (@course.subject.to_s + ' ' + @course.code.to_s), course_path(@course), "data-type" => "ext" %></h3>
</div>
<div><h4><%= @course.name %></h4></div>
<div><h5><%= @course.hours %> Hours, <%= @course.credit %> Credits</h5></div>

<% if @course.reviews.size > 0 %>
    <div class="center"><%= link_to course_path(@course), "data-type" => "ext" do %>
          <button>Reviews (<%= @course.reviews.size %>)</button>
      <% end %></div>
<% end %>

<div><h5><%= @course.description %></h5></div>
<div><h5>Prerequisites:
  <% if @course.prerequisite.nil? %>
      None.
  <% else %>
      <%= raw(get_expr_html(@course.prerequisite)) %>
  <% end %>
</h5></div>
<div><h5>Corequisites:
  <% if @course.corequisite.nil? %>
      None.
  <% else %>
      <%= raw(get_expr_html(@course.corequisite)) %>
  <% end %>
</h5></div>

<% unless current_user.nil? %>
    <% if current_user.is_taking_course?(@course) or current_user.has_completed_course?(@course) %>
        <% coursesindb = current_user.taking_courses.to_a %>
        <% coursesindb.concat(current_user.completed_courses.to_a) %>
        <% variable = -1 %>
        <% coursesindb.each do |cid| %>
            <% if cid.course == @course %>
                <% variable = cid %>
            <% end %>
        <% end %>
        <style>form {
            display: inline;
        }</style>
        <% if current_user.is_taking_course?(@course) %>
            <div class='center'>
              <%= form_tag({:controller => 'user_courses', :action => 'complete_course_taking', 'data-service' => variable}, {:class => 'useajax'}) do %>
                  <%= submit_tag t('course.mark_completed') %>
              <% end %>
              <%= form_tag({:controller => 'user_courses', :action => 'remove_course_taking', 'data-service' => variable}, {:class => 'useajax'}) do %>
                  <%= submit_tag t('course.remove') %>
              <% end %>
            </div>

        <% else %>
            <div class='center'>
              <% unless current_user.reviewed_course?(@course) %>
                  <a href='<%= course_review_new_path(@course) %>'>
                    <button><%= t("course.addreview") %></button>
                  </a>
              <% end %>
              <%= form_tag({:controller => 'user_courses', :action => 'remove_course_completed', 'data-service' => variable}, {:class => 'useajax'}) do %>
                  <%= submit_tag t('course.remove') %>
              <% end %>
            </div>
        <% end %>
    <% else %>
        <div class='center'>
          <style>form {
              display: inline;
          }</style>

          <a href='<%= user_take_course_path(@course) %>'>
            <button>
              <%= t('course.mark_taking') %>
            </button>
          </a>

          <%= form_tag({:controller => 'user_courses', :action => 'add_course_completed', :method => 'post'}, {:class => 'useajax'}) do %>
              <%= hidden_field_tag 'course', @course.id %>
              <%= submit_tag t('course.mark_completed'), :name => 'completed' %>
          <% end %>
        </div>

    <% end %>
<% end %>