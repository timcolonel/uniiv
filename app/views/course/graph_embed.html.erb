<% @course_status = "" %>

<% if current_user.is_taking_course?(@course) %>
  <% c = current_scenario.get_by_course(@course) %>
  <% unless c.semester.nil? or c.year.nil? %>
      <% @course_status = c.semester.to_s.capitalize + " " + c.year.to_s %>
  <% end %>
<% elsif current_user.has_completed_course?(@course) %>
  <% c = UserCompletedCourse.all.where(:user_id => current_user.id).where(:course_id => @course.id).first %>
  <% unless c.semester.nil? or c.year.nil? %>
      <% @course_status = c.semester.to_s.capitalize + " " + c.year.to_s %>
  <% end %>
<% end %>


<div>
  <h3 class='<%= get_course_css_class(@course) %> underline_link'><%= link_to (@course.subject.to_s + ' ' + @course.code.to_s), course_path(@course), "data-type" => "ext" %></h3> <h5 class='<%= get_course_css_class(@course) %>'><%= @course_status %></h5>
</div>
<div><h4><%= @course.name %></h4></div>

<div><h5><%= @course.hours %> Hours, <%= @course.credit %> Credits</h5></div>

<% unless current_user.nil? %>
    <% if current_user.is_taking_course?(@course) or current_user.has_completed_course?(@course) %>
        <% coursesindb = current_scenario.taking_courses.to_a %>
        <% coursesindb.concat(current_user.completed_courses.to_a) %>
        <% variable = -1 %>
        <% coursesindb.each do |cid| %>
            <% if cid.course == @course %>
                <% variable = cid %>
            <% end %>
        <% end %>
        <style>form {
            display: inline;
        }</style>
        <% if current_user.is_taking_course?(@course) %>
            <div class='center'>
              <%= link_to user_complete_course_ge_path(@course) do %>
                <button><%= t('course.mark_completed') %></button>
              <% end %>
              <%= form_tag(user_remove_course_ge_path(@course), {:class => 'useajax'}) do %>
                  <%= submit_tag t('course.remove') %>
              <% end %>

            </div>

        <% else %>
            <div class='center'>
              <% unless current_user.reviewed_course?(@course) %>
                  <%= link_to course_review_new_graph_embed_path(@course) do %>
                    <button><%= t('course.addreview') %></button>
                  <% end %>
              <% end %>
              <%= form_tag(user_remove_course_ge_path(@course), {:class => 'useajax'}) do %>
                  <%= submit_tag t('course.remove') %>
              <% end %>
            </div>
        <% end %>
    <% else %>
        <div class='center'>
          <style>form {
              display: inline;
          }</style>

          <%= link_to user_take_course_graph_embed_path(@course) do %>
            <button><%= t('course.mark_taking') %></button>
          <% end %>
          <%= link_to user_complete_course_ge_path(@course) do %>
            <button><%= t('course.mark_completed') %></button>
          <% end %>
        </div>


        <% if @course.reviews.size > 0 %>
            <div class="center">
              <%= link_to course_path(@course), "data-type" => "ext" do %>
                <button>Reviews (<%= @course.reviews.size %>)</button>
              <% end %>
            </div>
        <% end %>

    <% end %>
<% end %>

<div><h5>Prerequisites:
  <% if @course.prerequisite.nil? %>
      None.
  <% else %>
      <%= raw(get_expr_html(@course.prerequisite)) %>
  <% end %>
</h5></div>
<div><h5>Corequisites:
  <% if @course.corequisite.nil? %>
      None.
  <% else %>
      <%= raw(get_expr_html(@course.corequisite)) %>
  <% end %>
</h5></div>
<div><h5><%= @course.description %></h5></div>